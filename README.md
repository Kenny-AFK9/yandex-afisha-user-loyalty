# Анализ лояльности пользователей Яндекс Афиши

## Описание проекта
Команда маркетинга хочет лучше понимать поведение пользователей и выявить факторы, связанные с повторными заказами.
В рамках проекта проведён исследовательский анализ данных (EDA) по заказам пользователей Яндекс Афиши и построены агрегированные профили пользователей.

Цели проекта:
- выявить сегменты пользователей с высокой вероятностью повторных заказов;
- определить «точки входа» (тип мероприятия, устройство, регион, билетный оператор), влияющие на удержание;
- проверить продуктовые гипотезы о влиянии характеристик первого заказа на возврат;
- оценить связь повторных заказов с выручкой, количеством билетов и временными характеристиками;
- выполнить корреляционный анализ признаков профиля и количества заказов.

## Данные
Данные выгружены из базы данных с помощью SQL и содержат информацию о заказах пользователей.

Основные поля датасета:
- user_id — уникальный идентификатор пользователя;
- device_type_canonical — тип устройства первого заказа (mobile / desktop);
- order_id — идентификатор заказа;
- order_dt — дата создания заказа;
- order_ts — дата и время создания заказа;
- currency_code — валюта оплаты;
- revenue — выручка от заказа;
- tickets_count — количество билетов;
- days_since_prev — число дней с предыдущей покупки;
- event_type_main — тип мероприятия;
- service_name — билетный оператор;
- region_name — регион проведения мероприятия;
- city_name — город проведения мероприятия.

Для перевода выручки из KZT в RUB использован дополнительный датасет с курсом тенге за 2024 год.

## Ход исследования
### 1. Предобработка данных
- перевод выручки из тенге в рубли и расчёт показателя revenue_rub;
- анализ и обработка пропусков;
- оптимизация типов данных;
- анализ распределений и выбросов по выручке и количеству билетов;
- при необходимости фильтрация выбросов по 99 перцентилю.

### 2. Формирование профиля пользователя
Для каждого пользователя рассчитаны:
- дата первого и последнего заказа;
- параметры первого заказа (устройство, регион, сервис, тип мероприятия, день недели);
- общее количество заказов;
- средняя выручка с заказа;
- среднее количество билетов;
- средний интервал между заказами.

Дополнительно сформированы признаки:
- is_two — пользователь совершил 2 и более заказа;
- is_five — пользователь совершил 5 и более заказов.

### 3. Исследовательский анализ
- анализ распределения пользователей по сегментам первого заказа;
- анализ долей пользователей с повторными заказами;
- проверка продуктовых гипотез;
- анализ связи повторных заказов с выручкой и количеством билетов;
- анализ влияния дня недели первой покупки и интервалов между заказами.

### 4. Корреляционный анализ
- расчёт коэффициента корреляции phi_k между признаками профиля и количеством заказов;
- дополнительный анализ по сегментам пользователей (1 заказ / 2–4 заказа / 5+ заказов).

## Стек технологий
- Python
- pandas, numpy
- matplotlib, seaborn
- phik
- SQL

## Структура проекта
- notebooks/Проект 2 модуля Jupyter.ipynb — основной ноутбук с анализом;
- requirements.txt — список зависимостей;
- .gitignore — исключения для Git.

## Как запустить проект
1. Клонировать репозиторий:
git clone <repo_url>

2. Перейти в папку проекта:
cd <repo_folder>

3. Установить зависимости:
pip install -r requirements.txt

4. Запустить Jupyter Notebook:
jupyter notebook

## Примечание
Параметры подключения к базе данных и другие чувствительные данные не хранятся в репозитории и должны передаваться через переменные окружения (.env).
ß